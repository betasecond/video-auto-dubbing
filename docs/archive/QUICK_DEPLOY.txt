========================================
IndexTTS OpenAI API 快速部署指令
========================================

Step 1: SSH 登录
-----------------
ssh -p 41069 root@connect.bjb2.seetacloud.com
密码: xrQ8JU0uChe2


Step 2: 复制粘贴以下所有内容到远程终端
---------------------------------------

cd /root/index-tts-vllm && \
cp api_server_v2.py api_server_v2.py.backup.$(date +%Y%m%d_%H%M%S) && \
pkill -f "python api_server_v2.py" && \
sleep 2 && \
wget -O api_server_v2.py "https://gist.githubusercontent.com/your-gist-url/api_server_v2.py" || \
echo "手动替换文件内容..." && \
nohup python api_server_v2.py > /tmp/api_server_openai.log 2>&1 & && \
sleep 3 && \
curl -o /tmp/test.wav -H 'Content-Type: application/json' -d '{"model":"tts-1","input":"测试","voice":"alloy"}' http://localhost:6006/v1/audio/speech && \
file /tmp/test.wav


由于无法直接 wget，请使用以下手动方式：
========================================

1. 打开本地文件:
   /Users/micago/Desktop/index/video-auto-dubbing/api_server_v2_with_openai.py

2. 全选复制内容（Cmd+A, Cmd+C）

3. 在远程服务器执行：

cd /root/index-tts-vllm
cp api_server_v2.py api_server_v2.py.backup.$(date +%Y%m%d_%H%M%S)
pkill -f "python api_server_v2.py"
sleep 2
cat > api_server_v2.py << 'ENDOFFILE'
[这里粘贴复制的内容]
ENDOFFILE
nohup python api_server_v2.py > /tmp/api_server_openai.log 2>&1 &
sleep 3
ps aux | grep api_server


Step 3: 验证部署
-----------------
curl -o /tmp/test.wav \
  -H 'Content-Type: application/json' \
  -d '{"model":"tts-1","input":"你好世界","voice":"alloy","response_format":"wav"}' \
  http://localhost:6006/v1/audio/speech

file /tmp/test.wav
ls -lh /tmp/test.wav

# 期望输出:
# /tmp/test.wav: RIFF (little-endian) data, WAVE audio


Step 4: 本地测试外部访问
-------------------------
在本地终端执行：

cd /Users/micago/Desktop/index/video-auto-dubbing
./test_openai_api.sh


========================================
完成！检查点：
========================================
✓ 远程服务器进程运行中（ps aux | grep api_server_v2）
✓ 本地 curl 测试生成有效 WAV 文件
✓ 外部访问测试成功
✓ Worker 任务成功使用 TTS
